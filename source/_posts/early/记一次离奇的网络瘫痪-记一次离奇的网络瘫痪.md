---
title: 记一次离奇的网络瘫痪
date: 2019-07-19 16:51:52.0
updated: 2021-01-08 16:58:14.028
url: https://maoxian.fun/archives/记一次离奇的网络瘫痪
categories: 
tags: 
- 程序
- Web
---

今天下午，当我正在coding的时候，一上百度发现网络断开，紧接着qq下线、steam登出…刹时间我意识到，网络崩了。没过多久，系统（win10）右下角的网络显示网络无连接，尝试在“网络与Internet设置”中关闭有线连接适配器。

![img](https://img-maoxian-fun.oss-cn-hangzhou.aliyuncs.com/MxBlogImg/0bf5b4b02e59c95b0b37017eee894f00-ce4604-1610094903.png?x-oss-process=style/mxcompress)

万万没想到，当我禁用之后再次启用的时候居然无法启动，于是重启系统，结果又卡在了“正在重启”的界面，过了一会感觉像是卡住了就关机键长按关机再开机。开机的时候刷了一下手机，结果发现连着家庭wifi的手机正常上网？？？开机之后，尝试打开一个网页，居然成功了？？？

正当我以为网络正常的时候，打开了一个新网页，又出现了刚才的情况——没网了。于是输入192.168.3.1(这是我家主路由的ip地址），结果发现有线连接的路由器居然都连不上了，同时使用手机登录该地址查看路由设置，正常，检查了一下路由连接的终端设备，无线连接设备一切正常，有线连接一个都没有…这时我感觉到，事情并没有这么简单…

##### 网络情况介绍

![img](https://img-maoxian-fun.oss-cn-hangzhou.aliyuncs.com/MxBlogImg/039c7638b4cb69ebe053494d43248011-ef9a80-1610094927.png?x-oss-process=style/mxcompress)拓扑结构

上图是家里的网络拓扑结构图，入户光猫为网络入口，ip地址为192.168.1.1并且隐藏ssid，不作为日常使用。主路由为家中的主要路由设备，放置在书房作为主要的wifi广播信号，ip地址为192.168.3.1，有线设备全部通过交换机连接。由于额外一间房间由于户型结构的问题与主路由距离较远且中间有墙隔挡，wifi信号极差，正好家中有一台闲置的旧路由，就作为中继路由拓展主路由的无线信号（关闭DHCP、SSID和密码与主路由设置相同），并且因为这个是放在非主要房间的某个角落，所以我自己都忘了还有这个设备（这是前提）

##### 排查问题

开始排查问题，首先主机尝试登录192.168.3.1与192.168.1.1，均无法连接并且ping不通。之后尝试手机登录，均正常连接，查看终端设备发现没有有线设备。查看交换机，交换机上所有连接设备信号灯都在，并且闪烁，尝试拔出线缆，主机识别网线拔出，但是再插入时依然显示无网络连接。结合今日高温天气并且没有开空调，认为是网络设备高温宕机了，于是关闭所有路由和交换机（不包括中继路由）。几分钟后，设备温度恢复常温后再次开机，此时网络恢复，有线无线均正常，但是过了一会再次出现了以上的情况。此时发现无线连接的设备虽然可以上网但是一会可以一会不行，而有线连接是持续无法上网。

开始怀疑为设备故障的问题，尝试断开交换机，将主机连至主路由上，此时主机提示发现新网络并且网络正常。此时怀疑为交换机宕机。再次连接交换机，经过一段时间，再次出现网络无法连接。之后使用排除法，拔出所有交换机连接，仅保留与主路由连接线，每次插入一条网线进行排除测试。

最后，发现已经有一条线路连接上后，网络就出现瘫痪。随后检查该线路发现了已经被我遗忘的中继路由。尝试断开该中继路由发现网络恢复正常…至此，终于发现罪魁祸首。

##### 结果分析

可是为什么正常使用了一年时间才突然出现这个问题呢？推测如下：检查中继路由上的标签发现这个路由是2011年购买并且此前在老家作为主路由服役了较长时间，又由于高温导致该路由器故障异常，可是为什么子路由故障会导致整个网段瘫痪呢？结合交换机上的信号灯在所有设备均没有发起网络请求的情况下剧烈闪烁，推测由于设备故障引起了广播风暴导致网络发生阻塞…